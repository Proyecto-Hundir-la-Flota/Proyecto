<!DOCTYPE html>
<html lang="ca">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excavació Juràssica - Ranking</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/9c44094610.js" crossorigin="anonymous"></script>
</head>

<body id="ranking_page">

    <div class="tape">
        <div class="dinosaurs-left">
            <svg width="10px" height="10px" version="1.1" viewBox="0 0 1200 1200" preserveAspectRatio="none"
                xmlns="http://www.w3.org/2000/svg" xmlns:bx="https://boxy-svg.com">
                <path
                    d="M 520.381 572.885 C 574.982 549.924 621.554 540.597 657.333 540.647 C 719.945 540.733 762.732 561.489 796.125 552.227 C 829.518 542.981 879.168 475.671 895.034 420.399 C 910.884 365.129 959.313 209.476 988.914 169.937 C 1018.53 130.397 1038.664 108.096 1098.863 109.196 C 1135.37 109.874 1211.215 143.538 1198.6 207.664 C 1185.967 271.792 1094.916 237.603 1073.615 281.596 C 1052.329 325.606 1021.036 574.308 968.813 635.421 C 916.59 696.533 866.213 769.974 860.185 798.371 C 854.156 826.786 850.177 879.602 857.035 907.779 C 863.893 935.939 882.486 1049.732 861.337 1073.608 C 840.186 1097.484 787.828 1096.129 770.962 1072.169 C 754.079 1048.208 770.725 940.241 726.496 925.119 C 682.248 909.997 560.598 920.157 538.483 937.836 C 516.367 955.497 486.802 1025.975 471.63 1056.404 C 456.44 1086.816 391.568 1083.515 354.652 1076.775 C 317.721 1070.018 366.015 960.916 347.676 907.949 C 329.354 854.963 16.237 943.745 7.906 937.954 C -0.425 932.18 -2.423 921.427 3.114 914.078 C 8.651 906.712 285.717 843.635 317.061 750.839 C 348.387 658.061 464.713 596.295 520.381 572.885 Z"
                    stroke="#000" stroke-width=".085605" />
            </svg>
            <svg width="10px" height="10px" version="1.1" viewBox="0 0 1200 1200" preserveAspectRatio="none"
                xmlns="http://www.w3.org/2000/svg" xmlns:bx="https://boxy-svg.com">
                <path
                    d="M 520.381 572.885 C 574.982 549.924 621.554 540.597 657.333 540.647 C 719.945 540.733 762.732 561.489 796.125 552.227 C 829.518 542.981 879.168 475.671 895.034 420.399 C 910.884 365.129 959.313 209.476 988.914 169.937 C 1018.53 130.397 1038.664 108.096 1098.863 109.196 C 1135.37 109.874 1211.215 143.538 1198.6 207.664 C 1185.967 271.792 1094.916 237.603 1073.615 281.596 C 1052.329 325.606 1021.036 574.308 968.813 635.421 C 916.59 696.533 866.213 769.974 860.185 798.371 C 854.156 826.786 850.177 879.602 857.035 907.779 C 863.893 935.939 882.486 1049.732 861.337 1073.608 C 840.186 1097.484 787.828 1096.129 770.962 1072.169 C 754.079 1048.208 770.725 940.241 726.496 925.119 C 682.248 909.997 560.598 920.157 538.483 937.836 C 516.367 955.497 486.802 1025.975 471.63 1056.404 C 456.44 1086.816 391.568 1083.515 354.652 1076.775 C 317.721 1070.018 366.015 960.916 347.676 907.949 C 329.354 854.963 16.237 943.745 7.906 937.954 C -0.425 932.18 -2.423 921.427 3.114 914.078 C 8.651 906.712 285.717 843.635 317.061 750.839 C 348.387 658.061 464.713 596.295 520.381 572.885 Z"
                    stroke="#000" stroke-width=".085605" />
            </svg>
            <svg width="10px" height="10px" version="1.1" viewBox="0 0 1200 1200" preserveAspectRatio="none"
                xmlns="http://www.w3.org/2000/svg" xmlns:bx="https://boxy-svg.com">
                <path
                    d="M 520.381 572.885 C 574.982 549.924 621.554 540.597 657.333 540.647 C 719.945 540.733 762.732 561.489 796.125 552.227 C 829.518 542.981 879.168 475.671 895.034 420.399 C 910.884 365.129 959.313 209.476 988.914 169.937 C 1018.53 130.397 1038.664 108.096 1098.863 109.196 C 1135.37 109.874 1211.215 143.538 1198.6 207.664 C 1185.967 271.792 1094.916 237.603 1073.615 281.596 C 1052.329 325.606 1021.036 574.308 968.813 635.421 C 916.59 696.533 866.213 769.974 860.185 798.371 C 854.156 826.786 850.177 879.602 857.035 907.779 C 863.893 935.939 882.486 1049.732 861.337 1073.608 C 840.186 1097.484 787.828 1096.129 770.962 1072.169 C 754.079 1048.208 770.725 940.241 726.496 925.119 C 682.248 909.997 560.598 920.157 538.483 937.836 C 516.367 955.497 486.802 1025.975 471.63 1056.404 C 456.44 1086.816 391.568 1083.515 354.652 1076.775 C 317.721 1070.018 366.015 960.916 347.676 907.949 C 329.354 854.963 16.237 943.745 7.906 937.954 C -0.425 932.18 -2.423 921.427 3.114 914.078 C 8.651 906.712 285.717 843.635 317.061 750.839 C 348.387 658.061 464.713 596.295 520.381 572.885 Z"
                    stroke="#000" stroke-width=".085605" />
            </svg>
        </div>

        <h1>Rànquing de Paleontòlegs</h1>

        <div class="dinosaurs-right">
            <svg width="10px" height="10px" version="1.1" viewBox="0 0 1200 1200" preserveAspectRatio="none"
                xmlns="http://www.w3.org/2000/svg" xmlns:bx="https://boxy-svg.com">
                <path
                    d="M 520.381 572.885 C 574.982 549.924 621.554 540.597 657.333 540.647 C 719.945 540.733 762.732 561.489 796.125 552.227 C 829.518 542.981 879.168 475.671 895.034 420.399 C 910.884 365.129 959.313 209.476 988.914 169.937 C 1018.53 130.397 1038.664 108.096 1098.863 109.196 C 1135.37 109.874 1211.215 143.538 1198.6 207.664 C 1185.967 271.792 1094.916 237.603 1073.615 281.596 C 1052.329 325.606 1021.036 574.308 968.813 635.421 C 916.59 696.533 866.213 769.974 860.185 798.371 C 854.156 826.786 850.177 879.602 857.035 907.779 C 863.893 935.939 882.486 1049.732 861.337 1073.608 C 840.186 1097.484 787.828 1096.129 770.962 1072.169 C 754.079 1048.208 770.725 940.241 726.496 925.119 C 682.248 909.997 560.598 920.157 538.483 937.836 C 516.367 955.497 486.802 1025.975 471.63 1056.404 C 456.44 1086.816 391.568 1083.515 354.652 1076.775 C 317.721 1070.018 366.015 960.916 347.676 907.949 C 329.354 854.963 16.237 943.745 7.906 937.954 C -0.425 932.18 -2.423 921.427 3.114 914.078 C 8.651 906.712 285.717 843.635 317.061 750.839 C 348.387 658.061 464.713 596.295 520.381 572.885 Z"
                    stroke="#000" stroke-width=".085605" />
            </svg>
            <svg width="10px" height="10px" version="1.1" viewBox="0 0 1200 1200" preserveAspectRatio="none"
                xmlns="http://www.w3.org/2000/svg" xmlns:bx="https://boxy-svg.com">
                <path
                    d="M 520.381 572.885 C 574.982 549.924 621.554 540.597 657.333 540.647 C 719.945 540.733 762.732 561.489 796.125 552.227 C 829.518 542.981 879.168 475.671 895.034 420.399 C 910.884 365.129 959.313 209.476 988.914 169.937 C 1018.53 130.397 1038.664 108.096 1098.863 109.196 C 1135.37 109.874 1211.215 143.538 1198.6 207.664 C 1185.967 271.792 1094.916 237.603 1073.615 281.596 C 1052.329 325.606 1021.036 574.308 968.813 635.421 C 916.59 696.533 866.213 769.974 860.185 798.371 C 854.156 826.786 850.177 879.602 857.035 907.779 C 863.893 935.939 882.486 1049.732 861.337 1073.608 C 840.186 1097.484 787.828 1096.129 770.962 1072.169 C 754.079 1048.208 770.725 940.241 726.496 925.119 C 682.248 909.997 560.598 920.157 538.483 937.836 C 516.367 955.497 486.802 1025.975 471.63 1056.404 C 456.44 1086.816 391.568 1083.515 354.652 1076.775 C 317.721 1070.018 366.015 960.916 347.676 907.949 C 329.354 854.963 16.237 943.745 7.906 937.954 C -0.425 932.18 -2.423 921.427 3.114 914.078 C 8.651 906.712 285.717 843.635 317.061 750.839 C 348.387 658.061 464.713 596.295 520.381 572.885 Z"
                    stroke="#000" stroke-width=".085605" />
            </svg>
            <svg width="10px" height="10px" version="1.1" viewBox="0 0 1200 1200" preserveAspectRatio="none"
                xmlns="http://www.w3.org/2000/svg" xmlns:bx="https://boxy-svg.com">
                <path
                    d="M 520.381 572.885 C 574.982 549.924 621.554 540.597 657.333 540.647 C 719.945 540.733 762.732 561.489 796.125 552.227 C 829.518 542.981 879.168 475.671 895.034 420.399 C 910.884 365.129 959.313 209.476 988.914 169.937 C 1018.53 130.397 1038.664 108.096 1098.863 109.196 C 1135.37 109.874 1211.215 143.538 1198.6 207.664 C 1185.967 271.792 1094.916 237.603 1073.615 281.596 C 1052.329 325.606 1021.036 574.308 968.813 635.421 C 916.59 696.533 866.213 769.974 860.185 798.371 C 854.156 826.786 850.177 879.602 857.035 907.779 C 863.893 935.939 882.486 1049.732 861.337 1073.608 C 840.186 1097.484 787.828 1096.129 770.962 1072.169 C 754.079 1048.208 770.725 940.241 726.496 925.119 C 682.248 909.997 560.598 920.157 538.483 937.836 C 516.367 955.497 486.802 1025.975 471.63 1056.404 C 456.44 1086.816 391.568 1083.515 354.652 1076.775 C 317.721 1070.018 366.015 960.916 347.676 907.949 C 329.354 854.963 16.237 943.745 7.906 937.954 C -0.425 932.18 -2.423 921.427 3.114 914.078 C 8.651 906.712 285.717 843.635 317.061 750.839 C 348.387 658.061 464.713 596.295 520.381 572.885 Z"
                    stroke="#000" stroke-width=".085605" />
            </svg>
        </div>
    </div>

    <?php
$file = 'ranking.txt';
$records_per_page = 25;

// Si el archivo no existe, crearlo vacío
if (!file_exists($file)) {
    file_put_contents('ranking.txt', '');
}

// Verifica si los datos han sido enviados por POST
if (isset($_POST['score']) && isset($_POST['name'])) {
    $score = $_POST['score'];
    $name = trim($_POST['name']);  // Limpiar el nombre de espacios en blanco
    $holder = $name;  // Almacenar el nombre del jugador actual
    $timestamp = date('Y-m-d H:i:s'); // Generar timestamp

    // Guardar los datos en el archivo
    file_put_contents($file, $name . "/" . $score . '/' . $timestamp . "#\n", FILE_APPEND);
}

// Cargar el contenido del archivo
$content = file_get_contents($file);
$lines = explode('#', $content);
$filtered_lines = array_filter($lines, 'trim');  // Limpiar las líneas de espacios en blanco


// Comprobar si hay registros
if (empty($filtered_lines)) {
    echo "<p class='empty-txt'>No hi ha cap paleontòleg registrat</p>";
} else {
    // Ordenar registros
    usort($filtered_lines, function ($a, $b) {
        list(, $pointsA) = explode('/', $a);
        list(, $pointsB) = explode('/', $b);
        return $pointsB - $pointsA;
    });

    $total_records = count($filtered_lines);
    $total_pages = ceil($total_records / $records_per_page);
    $current_page = isset($_GET['page']) ? (int)$_GET['page'] : 1;
    if ($current_page < 1) $current_page = 1;
    
    $start_index = ($current_page - 1) * $records_per_page;
    $end_index = min($start_index + $records_per_page, $total_records);

    // Mostrar la tabla
// Mostrar la tabla
echo '<table>
    <tr>
        <th>#</th>
        <th>Nom del Paleontòleg</th>
        <th>Fama Adquirida</th>
        <th>Data i Hora de l\'Excavació</th>
    </tr>';

for ($i = $start_index; $i < $end_index; $i++) {
    if (!empty(trim($filtered_lines[$i]))) {
        list($name, $points, $dateTime) = explode('/', $filtered_lines[$i]);
        $name = trim($name);  // Limpiar el nombre de la línea actual
        $row_index = $i + 1;

        // Clase podium para los primeros tres registros
        $class = ($i < 3) ? ' class="podium"' : '';
        
        // Clase para el registro del usuario que acaba de jugar
        $class2 = ($name === $holder) ? ' id="player"' : '';

        echo "<tr{$class}{$class2}>
            <td>$row_index</td>
            <td>$name</td>
            <td>$points</td>
            <td>$dateTime</td>
        </tr>";
    }
}

echo '</table>';


    // Paginación
    echo '<div class="navigation-container">';
    echo '<a href="index.php" class="nav-button home-button"><i class="fa-solid fa-chevron-left icon"></i>Inici</a>';
    if ($total_pages > 1) {
        echo '<div class="pagination">';

        if ($current_page > 1) {
            echo '<a href="?page=' . ($current_page - 1) . '" class="fa-solid fa-chevron-left"></a>';
        }

        for ($page = 1; $page <= $total_pages; $page++) {
            if ($page == $current_page) {
                echo '<span class="current-page">' . $page . '</span>';
            } else {
                echo '<a class="page" href="?page=' . $page . '">' . $page . '</a>';
            }
        }

        if ($current_page < $total_pages) {
            echo '<a href="?page=' . ($current_page + 1) . '" class="fa-solid fa-chevron-right"></a>';
        }
    }
}